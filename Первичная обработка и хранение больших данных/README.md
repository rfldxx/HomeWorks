# Вариант 5

## Задание 1
Нам данно две таблицы:
- (cубъект, год) -> потреблению электроэнергии
- (cубъект) -> округ

Требуется подсчитать суммарное потребление электроэнергии в 2009 году по округу Сибирский.

1. Сначала узнаем какие `cубъекты` входят в этот `округ` - это делает программа t1_1.cpp. 

    (!везде без лишних пробелов) \
    Формат входных данных:
    - первая строка: название `округа` для поиска
    - следующие строки: `cубъект,округ` или `cубъект,округ,`

    Печатает:
    - первая строка: количество подходящих `cубъектов`
    - далее на каждой новой строчке название `cубъекта`

    <details>

    <summary> Результат: </summary>
    
    ```
    12
    Алтайский край
    Иркутская область
    Кемеровская область
    Красноярский край
    Новосибирская область
    Омская область
    Республика Алтай
    Республика Бурятия
    Республика Тыва
    Республика Хакасия
    Томская область
    Читинская область
    ```
    </details>

2. Далее...

	[добавление]: Формат входных данных:
	- первая строка: $n$ - количество подходящих `cубъектов`
   	- далее $n$ строчек, где на каждой название подходящего `cубъекта`
    - следующие строки: `cубъект,потребление_год1,потребление_год2,...`

	В программе захардкоженно, что количество годов в которые проводились измерения - $13$. \
	И что нужное нам измерение (за $2009$ год) является предпоследним. \
	[конец добавления]

    <details>

    <summary> Лог t1_2.cpp </summary>

    ```
    SEARCH:
    Алтайский край
    Иркутская область
    Кемеровская область
    Красноярский край
    Новосибирская область
    Омская область
    Республика Алтай
    Республика Бурятия
    Республика Тыва
    Республика Хакасия
    Томская область
    Читинская область

    [FIND] Республика Алтай : 512.9
    [FIND] Республика Бурятия : 4739.3
    [FIND] Республика Тыва : 669.8
    [FIND] Республика Хакасия : 17048.6
    [FIND] Алтайский край : 10005.4
    [FIND] Красноярский край : 49995.4
    [FIND] Иркутская область : 52409.7
    [FIND] Кемеровская область : 33020.5
    [FIND] Новосибирская область : 15192
    [FIND] Омская область : 10111
    [FIND] Томская область : 9642.6
    [FIND] Читинская область : 7429
    
    SUM: 210776.200000
    ```
    </details>

**Ответ:** 210776.2



## Задание 2

Нам данно (уже без C++ парсинга):
```
Субъект,1990,1995,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010
Тульская область,15820.1,10952.5,10519.8,10600.4,10290.5,11470.0,10353.7,10265.2,10510.2,9953.1,9976.8,9120.7,9578.2
```

Запишем данные с 2000 по 2010 годы в массив:
```
vector<double> x = {10519.8, 10600.4, 10290.5, 11470.0, 10353.7, 10265.2, 10510.2, 9953.1, 9976.8, 9120.7, 9578.2};
```

1. Среднее значение: $x_{mean} = \sum\limits_{i=1}^n x_i / n$

2. Дисперсия: $\sum\limits_{i=1}^n (x_i - x_{mean})^2 / n$


<details>

<summary> Код </summary>

```cpp
#include <bits/stdc++.h>
using namespace std;

int main() {
    vector<double> x = {10519.8, 10600.4, 10290.5, 11470.0, 10353.7, 10265.2, 10510.2, 9953.1, 9976.8, 9120.7, 9578.2};
    int n = x.size();

    // 1. подсчёт среднего:
    double sum = 0;
    for(auto e : x) sum += e;
    double xx = sum/n;
    cout << "Mean: " << fixed << xx << endl;
    
    // 2. подсчёт дисперсии:
    double D = 0;
    for(auto e : x) D += (e-xx) * (e-xx);
    cout << "Dispersion: " << fixed << (D/n) << endl;
}
```
</details>

$\text{ }$


Найдите среднее значение (ответ округлите до целых млн.кВт.час): \
**Ответ:** $10240$.

Найдите дисперсию (ответ округлите до целых млн.кВт.час): \
**Ответ:** $332054$.



## Задание 3

Дан временной ряд:

$y =[51, 50, 37, 42, 55, 56, 53, 40, 46, 43, 59, 52, 48, 44, 65, 57, 62, 60, 61, 70, 63, 54, 64, 58, 71]$

Будем считать в решении что отсчёт начинается с $x = 1$.

1. Коэффициент линейного тренда, задаваемого уравнением вида $y= ax + b$:
    - $a = \dfrac{n \sum_i (x_i \cdot y_i) - (\sum_i x_i) \cdot (\sum_i y_i)}{n (\sum_i x_i^2) - (\sum_i x_i)^2}$
    - $b = \dfrac{(\sum_i y_i) - a \cdot (\sum_i x_i)}{n}$

2. Коэффициент детерминации $R^2$:
    - $R^2 = 1 - \dfrac{\sum_i (ax_i+b - y_i)^2}{\sum_i (y_{avg} - y_i)^2}$

<details>

<summary> Код </summary>

```cpp
#include <bits/stdc++.h>
using namespace std;

int main() {
    vector<int> Y = {51, 50, 37, 42, 55, 56, 53, 40, 46, 43, 59, 52, 48, 44, 65, 57, 62, 60, 61, 70, 63, 54, 64, 58, 71};
    int N = Y.size();
  
    // 1. Линейнй тренд
    long long sx = 0, sy = 0, sxy = 0, sxx = 0;
    for(int i = 0; i < N; i++) {
        int x = i+1, y = Y[i];
        sx += x; sy += y; sxy += x*y; sxx += x*x;
    }

    long double a = 1.* (N * sxy - sx*sy) / (N*sxx - sx*sx);
    long double b = (sy - a*sx) / N; 

    cout << "f = " << a << " *x + " << b << endl;

    // 2. Определите коэффициент детерминации R^2
    long double A = 0, B = 0, y_avg = 1.* sy/N;
    for(int i = 0; i < N; i++) {
        int x = i+1;
        A += (a*x+b - Y[i]) * (a*x+b - Y[i]);
        B += (y_avg - Y[i]) * (y_avg - Y[i]);
    }
    long double R2 = 1 - A/B;
    cout << "R^2: " << R2 << endl;
}
```
</details>

$\text{ }$

Определите коэффициент $a$ линейного тренда, задаваемого уравнением вида $y= ax + b$. (округленное до сотых, десятичный разделитель — точка): \
**Ответ:** $0.87$.

Определите коэффициент детерминации $R^2$ для тренда. (округленное до тысячных, десятичный разделитель — точка): \
**Ответ:** $0.481$.


## Задание 5
В таблице VISITOR содержатся сведения о посетителях музеев. Сколько среди них посетителей по имени `Борис`?

```
select count(*) from 
    (select distinct visitor_id from VISITOR where first_name = 'Борис') as ab
```

**Ответ:** $450$.


## Задание 6
В каком из упомянутых в базе музеев хранятся произведения `Михаил Перхин`? Сколько именно произведений?


Введите название музея ровно так, как оно хранится в базе данных:  

```
select distinct museum_name from museum natural join hall natural join exhibit where author = 'Михаил Перхин'
```

**Ответ:** Музей Фаберже.


Введите количество произведений
```
select count(*) from 
	(select distinct exhibit_id from museum natural join hall natural join exhibit where author = 'Михаил Перхин' ) as ab
```
**Ответ:** $5$.

## Задача 7
В базе данных хранятся сведения о произведениях некоторых авторов из нескольких музеев Санкт-Петербурга. Укажите название самого раннего произведения (из упомянутых в базе) автора `Генрик Вигстрём`?
Введите название произведения ровно так, как оно хранится в базе данных:

Запрос: `select * from museum` - показал что все музеи в Санкт-Петербурге.

```
SELECT year_of_creation, exhibit_name
FROM   museum natural join hall natural join exhibit where author = 'Генрик Вигстрём'
ORDER BY year_of_creation
LIMIT 1
```

(онако если посмотртеть все результаты то там окажется одно произведение с `year_of_creation is NULL`)

**Ответ:** Флакон парфюмерный с крышкой в виде женской головки.

## Задача 8

Сколько посетителей приобрели билеты на экскурсию Экскурсионный сеанс по музею в 4 месяце 2023 года?

Введите количество посетителей:

Для простоты сразу найдем `id` нужной экскурсии (но можно просто везде вложенный `select` писать):
```
SELECT excursion_id from excursion where excursion_name = 'Экскурсионный сеанс по музею'
```
Получили: `excursion_id = 25`.

```
SELECT count(*) 
FROM   schedule natural join visitor_schedule 
WHERE  excursion_id = 25 and '2023-04-01 00:00' <= starts_on and starts_on < '2023-05-01 00:00'
```

**Ответ:** $1867$.

$\text{ }$

---

Дорешка:

## Задание 4

Все данные для ответов брались из этого вывода программы:
<details>

<summary> Лог вызова t4.cpp: </summary>

```
3 : "Широкая полоса скашивания на данной газонокосилке позволяет быстро и эффективно обрезать траву на больших участках
2 : Средняя ширина скашиваемой полосы на данной газонокосилке позволяет легко и быстро поддерживать средний размер газона без утомительных повторных проходов.
1 : Узкая ширина скашиваемой полосы на данной газонокосилке делает ее идеальной для обрезки травы в узких проходах и около краев газона.
1 : Узкая ширина скашиваемой полосы на данной газонокосилке делает ее идеальной для обрезки травы в узких проходах и около краев газона.
2 : Средняя ширина скашиваемой полосы на данной газонокосилке позволяет легко и быстро поддерживать средний размер газона без утомительных повторных проходов.
2 : Средняя ширина скашиваемой полосы на данной газонокосилке позволяет легко и быстро поддерживать средний размер газона без утомительных повторных проходов.
2 : Средняя ширина скашиваемой полосы на данной газонокосилке позволяет легко и быстро поддерживать средний размер газона без утомительных повторных проходов.
2 : Средняя ширина скашиваемой полосы на данной газонокосилке позволяет легко и быстро поддерживать средний размер газона без утомительных повторных проходов.
2 : Средняя ширина скашиваемой полосы на данной газонокосилке позволяет легко и быстро поддерживать средний размер газона без утомительных повторных проходов.
1 : Узкая ширина скашиваемой полосы на данной газонокосилке делает ее идеальной для обрезки травы в узких проходах и около краев газона.
1 : Узкая ширина скашиваемой полосы на данной газонокосилке делает ее идеальной для обрезки травы в узких проходах и около краев газона.
2 : Средняя ширина скашиваемой полосы на данной газонокосилке позволяет легко и быстро поддерживать средний размер газона без утомительных повторных проходов.
2 : Средняя ширина скашиваемой полосы на данной газонокосилке позволяет легко и быстро поддерживать средний размер газона без утомительных повторных проходов.
2 : Средняя ширина скашиваемой полосы на данной газонокосилке позволяет легко и быстро поддерживать средний размер газона без утомительных повторных проходов.
3 : "Широкая полоса скашивания на данной газонокосилке позволяет быстро и эффективно обрезать траву на больших участках
1 : Узкая ширина скашиваемой полосы на данной газонокосилке делает ее идеальной для обрезки травы в узких проходах и около краев газона.
1 : Узкая ширина скашиваемой полосы на данной газонокосилке делает ее идеальной для обрезки травы в узких проходах и около краев газона.
3 : "Широкая полоса скашивания на данной газонокосилке позволяет быстро и эффективно обрезать траву на больших участках
3 : "Широкая полоса скашивания на данной газонокосилке позволяет быстро и эффективно обрезать траву на больших участках
1 : Узкая ширина скашиваемой полосы на данной газонокосилке делает ее идеальной для обрезки травы в узких проходах и около краев газона.
N = 200

Median WIDTH (by WIDTH in [30, 35]):  32 (cnt=67)
Avg    WIDTH (by WIDTH in [36, 40]):  37.9333 -> 38
Median WIDTH (by WIDTH in [41, 55]):  42 (cnt=53)
Avg WIDTH after restoring values: 37.175

All PRICE (sorted): 8000 8000 8000 8000 8000 9000 9000 9000 9000 9000 9000 9000 10000 10000 10000 10000 10000 10000 10000 11000 11000 11000 11000 
12000 12000 12000 12000 12000 12000 13000 13000 13000 13000 13000 13000 13000 13000 14000 14000 14000 14000 14000 15000 15000 15000 15000 15000 16000 16000 16000 17000 17000 17000 17000 18000 18000 18000 18000 18000 18000 19000 19000 19000 19000 19000 19000 20000 20000 20000 20000 21000 21000 21000 22000 22000 22000 23000 23000 23000 23000 24000 24000 24000 25000 25000 25000 26000 26000 26000 26000 27000 27000 27000 27000 27000 27000 
27000 27000 27000 27000 28000 28000 29000 29000 29000 29000 29000 30000 30000 30000 30000 30000 31000 31000 31000 32000 32000 32000 32000 32000 33000 33000 33000 33000 33000 33000 34000 34000 34000 34000 36000 36000 36000 36000 36000 36000 36000 37000 37000 37000 37000 37000 37000 38000 38000 38000 38000 38000 38000 39000 39000 39000 39000 39000 40000 40000 40000 40000 40000 40000 41000 41000 41000 41000 42000 42000 43000 43000 44000 
44000 45000 45000 45000 46000 46000 46000 46000 46000 46000 46000 46000 47000 47000 48000 48000 48000 246208 353613 368249 469730 534773 563808 610233 680817 696777 901086
Q1 = 16000, Q2 = 27000, Q3 = 38000
PRICE is outlier if: PRICE <= -50000 or 104000 <= PRICE
Remain after cleaning data: 174 elements
Avg WIDTH after restoring values: 26241.379310

Lawnmower (Gardez IER578 with id==57): 57 0.20811 0.527633 0.718231 0.32968 0.632121

Loss = 2.86298 : on indx: 166
Loss = 3.03968 : on indx: 187
Loss = 3.06914 : on indx: 164
```
</details>

$\text{ }$

При выборе газонокосилки Юрий собрал следующие данные об аккумуляторных газонокосилках:
- Название газонокосилки — `NAME`
- Ширина скашиваемой полосы — `WIDTH`
- Стоимость — `PRICE`
- Мощность — `POWER`
- Объем травосборника — `GRASS`
- Площадь скашиваемой поверхности на одном заряде аккумулятора — `AREA`
- Описание газонокосилки — `DESCRIPTION`

Не все оказалось идеально с данными. Некоторые значения оказались пропущены, некоторые явно содержали экстремальные выбросы. Юрию пришлось обработать исходные данные следующим образом:

1. Параметр "Ширина скашиваемой полосы" содержал много пропущенных значений. Юрий придумал следующий алгоритм по их восстановлению:

    - Если в описании газонокосилки встречались слова "узкая|узкие|узкую|узкой", то значение восстанавливалось как медиана по существующим в исходном датасете значениям в диапазоне от $30$ до $35$.

        Введите медиану по существующим в исходном датасете значениям в диапазоне от $30$ до $35$. \
        **Ответ:** $32$.


    - Если встречались слова "средняя ширина"/"ширина средняя", то значение восстанавливалось как округленное до целого среднее арифметическое по существующим значениям в диапазоне от $36$ до $40$.

        Введите округленное до целого среднее арифметическое по существующим в исходном датасете значениям в диапазоне от $36$ до $40$. \
        **Ответ:** $38$.



    - Если встречались слова ("широкая" и "полоса")/("широкие" и "полосы"), то значение восстанавливалось как медиана по существующим значениям в диапазоне от $41$ до $45$.

        Введите медиану по существующим в исходном датасете значениям в диапазоне от $41$ до $45$. \
        **Ответ:** $42$.

 
    Введите среднее арифметическое для параметра "Ширина скашиваемой полосы" после восстановления пропущенных значений (ответ округлите до сотых)  \
    **Ответ:** $37.18$.
 
2. Цены на газонокосилки имели очень большой разброс, и Юрий решил избавиться от вариантов, стоимость которых попадала под определение "экстремальных выбросов".
    - Квантили $Q_1, Q_2, Q_3$ для "массива" $x$ - значение которое находится на
    - Размах квантилий: $IQR = Q_3 - Q1$
    - Экстремальные выбросы удалены ниже $Q_1$ или выше $Q_3$ более чем на $3 \cdot IQR$
    - В нашем случае мы оставляем цены из промежутка: $[-50000, +104000]$ \
    Цены на верхней границе промежутка: `... 48000 | 246208 ...`.

3. Затем Юрий исключил записи, в которых все еще оставались пропущенные значения.

    Введите количество оставшихся к рассмотрению газонокосилок: \
    **Ответ:** $174$.
 
    Введите среднее арифметическое для параметра "Стоимость" полученного после обработки набора данных: (ответ округлите до сотых) \
    **Ответ:** $26241.38$.
 
4. Параметры газонокосилок имеют разную размерность, так что Юрий решил экспоненциально нормировать значения числовых параметров.

    Введите нормированные значения параметров газнокосилки Gardez IER578 (у этой газонокосилки оказался индекс $57$):

    - Ширина скашиваемой полосы: (ответ округлите до сотых) \
    **Ответ:** $0.21$.

    - Стоимость: (ответ округлите до сотых) \
    **Ответ:** $0.53$.

    - Мощность: (ответ округлите до сотых) \
    **Ответ:** $0.72$.

    - Объем травосборника: (ответ округлите до сотых) \
    **Ответ:** $0.33$.

    - Площадь скашиваемой поверхности на одном заряде аккумулятора: (ответ округлите до сотых) \
    **Ответ:** $0.63$.


5. И наконец, Юрий составил целевую функцию, на основе которой определил 3 наиболее подходящие (на его взгляд) газонокосилки. При определении целевой функции он использовал следующие слагаемые:
    - Нормированная ширина скашиваемой полосы с коэффициентом 5
    - Стоимость как слагаемое вида (1 - нормированная стоимость) с коэффициентом 5
    - Нормированную мощность с коэффициентом 5
    - Нормированный объём травосборника с коэффициентом 5
    - Нормированную площадь скашиваемой поверхности с коэффициентом 2

    Какие 3 газонокосилки являются лучшими (по целевой функции Юрия)? Введите три названия газонокосилок через запятую, например Cooper XWZ182, Nakita 74FHSC, Cooper INH176: \
    (программа нашла, что это газонокосилки под id: 166, 187, 164) \
    **Ответ:** Gardez ZNY596, Champion YCV192, Nakita VEF634.


